import struct

class sun2000:

    PHASE1_VOLTAGE_VOLT = 32111
    PHASE2_VOLTAGE_VOLT = 32113
    PHASE3_VOLTAGE_VOLT = 32115
    PHASE1_CURRENT_AMP = 32103
    PHASE2_CURRENT_AMP = 32105
    PHASE3_CURRENT_AMP = 32107
    PHASE1_POWER_KW = 32129
    PHASE2_POWER_KW = 32131
    PHASE3_POWER_KW = 32133
    PHASE1_POWER_KVOLTAMPS = 32145
    PHASE2_POWER_KVOLTAMPS = 32147
    PHASE3_POWER_KVOLTAMPS = 32149
    PHASE1_POWER_KVOLTAMPSREACTIVE = 32137
    PHASE2_POWER_KVOLTAMPSREACTIVE = 32139
    PHASE3_POWER_KVOLTAMPSREACTIVE = 32141
    PHASE1_PF = 32153
    PHASE2_PF = 32155
    PHASE3_PF = 32157
    TOTALSYSTEM_POWER_KW = 32127
    TOTALSYSTEM_POWER_KVOLTAMPS = 32143
    TOTALSYSTEM_POWER_KVOLTAMPSREACTIVE = 32135
    TOTALSYSTEM_PF = 32151
    FREQUENCY_HZ = 32125
    TOTALIMPORT_KWH = 32167
    TOTALEXPORT_KWH = 32175
    PHASE1_MIN_PHASE2_VOLTAGE = 32119
    PHASE2_MIN_PHASE3_VOLTAGE = 32121
    PHASE3_MIN_PHASE1_VOLTAGE = 32123
    TOTAL_SYSTEM_ENERGY_KWH = 32159
    TOTAL_PHASE1_ENERGY_KWH = 32161
    TOTAL_PHASE2_ENERGY_KWH = 32163
    TOTAL_PHASE3_ENERGY_KWH = 32165

    registers=dict()

    def __init__(self):
        self.registers[32002] = 0x3b11
        

    def set_register(self, sun2000_regnum, value):
        value = float(value)
        dualregs = struct.unpack('>HH', struct.pack('>f', value))
        
        self.registers[sun2000_regnum+0] = dualregs[0]
        self.registers[sun2000_regnum+1] = dualregs[1]


    